{"title":"bash command","slug":"bash-command","date":"2023-01-29T11:28:11.000Z","updated":"2023-02-11T02:46:26.760Z","comments":true,"path":"api/articles/bash-command.json","photos":[],"link":"","excerpt":null,"covers":null,"content":"<h3 id=\"查看内存使用多的进程\"><a href=\"#查看内存使用多的进程\" class=\"headerlink\" title=\"查看内存使用多的进程\"></a>查看内存使用多的进程</h3><figure class=\"highlight dos\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">top  按M 按内存排序</span><br><span class=\"line\">ps <span class=\"built_in\">aux</span> | <span class=\"built_in\">sort</span> -k4nr | head -<span class=\"number\">10</span></span><br><span class=\"line\">ps <span class=\"built_in\">aux</span> --<span class=\"built_in\">sort</span> -rss</span><br></pre></td></tr></table></figure>\n<h3 id=\"查看cpu使用多的进程\"><a href=\"#查看cpu使用多的进程\" class=\"headerlink\" title=\"查看cpu使用多的进程\"></a>查看cpu使用多的进程</h3><figure class=\"highlight coq\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">top</span>  按P 按cpu排序</span><br><span class=\"line\">ps aux | <span class=\"type\">sort</span> -k3nr | <span class=\"type\">head</span> <span class=\"number\">-10</span></span><br></pre></td></tr></table></figure>\n<p>ps 命令结果格式</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">USER</span> <span class=\"title\">- PID</span> - %CPU - %MEM - VSZ - RSS - TTY - STAT - <span class=\"literal\">START</span> - TIME - COMMAND</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"多进程gstack\"><a href=\"#多进程gstack\" class=\"headerlink\" title=\"多进程gstack\"></a>多进程gstack</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps aux | grep server | grep -v grep | awk <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span> | <span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line; <span class=\"keyword\">do</span> gstack <span class=\"string\">&quot;<span class=\"variable\">$line</span>&quot;</span> &gt;&gt; tmp.log; <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"grep多个值\"><a href=\"#grep多个值\" class=\"headerlink\" title=\"grep多个值\"></a>grep多个值</h3><figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">grep</span> -E <span class=\"string\">&#x27;123|abc&#x27;</span> filename</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"去重\"><a href=\"#去重\" class=\"headerlink\" title=\"去重\"></a>去重</h3><figure class=\"highlight arcade\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sort</span> -t <span class=\"string\">&#x27;,&#x27;</span> -k <span class=\"number\">1</span>,<span class=\"number\">1</span> -u</span><br><span class=\"line\">-t 指定列之间的分隔符，-k指定从第几列到第几列作为去重标准</span><br></pre></td></tr></table></figure>\n<h3 id=\"使用以下命令查找哪些文件已被删除被某些程序占用导致句柄未释放\"><a href=\"#使用以下命令查找哪些文件已被删除被某些程序占用导致句柄未释放\" class=\"headerlink\" title=\"使用以下命令查找哪些文件已被删除被某些程序占用导致句柄未释放\"></a>使用以下命令查找哪些文件已被删除被某些程序占用导致句柄未释放</h3><figure class=\"highlight 1c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lsof -n <span class=\"string\">| grep deleted</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>tips<br>系统默认用户地址空间文件缓冲区大小4096字节，FILE结构本身有一个缓冲区</li>\n</ul>\n<h3 id=\"查找-替换目录下所有文件关键词\"><a href=\"#查找-替换目录下所有文件关键词\" class=\"headerlink\" title=\"查找, 替换目录下所有文件关键词\"></a>查找, 替换目录下所有文件关键词</h3><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -rn <span class=\"string\">&quot;pg_xact&quot;</span> &#123;ref/*<span class=\"string\">.sgml</span>,*<span class=\"string\">.sgml</span>&#125;</span><br><span class=\"line\">sed  -i  &#x27;s/pg_internal/zb_internal/g&#x27;  &#123;*<span class=\"string\">.sgml</span>,ref/*<span class=\"string\">.sgml</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用rsync删除大量文件\"><a href=\"#使用rsync删除大量文件\" class=\"headerlink\" title=\"使用rsync删除大量文件\"></a>使用rsync删除大量文件</h3><figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir <span class=\"regexp\">/tmp/</span>test</span><br><span class=\"line\">rsync --<span class=\"keyword\">delete</span>-before -a -H -v --progress --stats <span class=\"regexp\">/tmp/</span>test<span class=\"regexp\">/ /</span>home<span class=\"regexp\">/yh/</span>eva/</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"linux下递归删除目录下所有指定类型文件\"><a href=\"#linux下递归删除目录下所有指定类型文件\" class=\"headerlink\" title=\"linux下递归删除目录下所有指定类型文件\"></a>linux下递归删除目录下所有指定类型文件</h3><figure class=\"highlight sqf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">find</span> . -<span class=\"built_in\">name</span> <span class=\"string\">&#x27;.*&#x27;</span> -<span class=\"built_in\">type</span> f -delete   <span class=\"meta\"># better</span></span><br><span class=\"line\"><span class=\"built_in\">find</span> . -<span class=\"built_in\">name</span>  <span class=\"string\">&#x27;.*&#x27;</span> -<span class=\"built_in\">type</span>  f -print -<span class=\"built_in\">exec</span>  rm -rf  &#123;&#125; \\;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"去空行\"><a href=\"#去空行\" class=\"headerlink\" title=\"去空行\"></a>去空行</h3><figure class=\"highlight delphi\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i <span class=\"string\">&#x27;/^$/d&#x27;</span> <span class=\"keyword\">file</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"grep-amp-mv批量移动匹配文件\"><a href=\"#grep-amp-mv批量移动匹配文件\" class=\"headerlink\" title=\"grep&amp;mv批量移动匹配文件\"></a>grep&amp;mv批量移动匹配文件</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">ls</span> -m1 | grep <span class=\"string\">&quot;pattern&quot;</span> &gt; tmp.txt</span><br><span class=\"line\"><span class=\"built_in\">cat</span> tmp.txt | <span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line; <span class=\"keyword\">do</span> <span class=\"built_in\">mv</span> <span class=\"string\">&quot;<span class=\"variable\">$line</span>&quot;</span> path_to_mv; <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"提取相似文件某一行一列值的和-amp-平均值\"><a href=\"#提取相似文件某一行一列值的和-amp-平均值\" class=\"headerlink\" title=\"提取相似文件某一行一列值的和&amp;平均值\"></a>提取相似文件某一行一列值的和&amp;平均值</h3><figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">tail</span> -n <span class=\"number\">1</span> tpcc-original-result/tpcc_&#123;<span class=\"number\">2</span>..<span class=\"number\">10</span>&#125;.log | awk &#x27;NR%<span class=\"number\">3</span>==<span class=\"number\">2</span> &#123; print <span class=\"string\">&quot;No&quot;</span>, (NR+<span class=\"number\">1</span>)/<span class=\"number\">3</span>, <span class=\"string\">&quot;tpmC:&quot;</span>, $<span class=\"number\">2</span>; s+=$<span class=\"number\">2</span>; n++&#125; END&#123;print <span class=\"string\">&quot;total:&quot;</span>, s, <span class=\"string\">&quot;rows:&quot;</span>, n, <span class=\"string\">&quot;avg:&quot;</span>, s/n&#125;&#x27;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"批量kill-进程\"><a href=\"#批量kill-进程\" class=\"headerlink\" title=\"批量kill 进程\"></a>批量kill 进程</h3><figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ps</span> -ef | <span class=\"keyword\">grep</span> <span class=\"string\">&quot;pattern&quot;</span> | <span class=\"keyword\">grep</span> -v <span class=\"keyword\">grep</span> | awk <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span> | xargs kill -<span class=\"number\">9</span> </span><br><span class=\"line\"><span class=\"keyword\">ps</span> aux | <span class=\"keyword\">grep</span> <span class=\"string\">&quot;pattern&quot;</span> | awk <span class=\"string\">&#x27;&#123;print &quot;sudo kill -9 &quot;$2&#125;&#x27;</span> | <span class=\"keyword\">sh</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"文件压缩解压\"><a href=\"#文件压缩解压\" class=\"headerlink\" title=\"文件压缩解压\"></a>文件压缩解压</h3><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -cvf tarname<span class=\"selector-class\">.tar</span> foldername 压缩</span><br><span class=\"line\">tar -xvf tarname<span class=\"selector-class\">.tar</span> -C pathToSave 解压</span><br><span class=\"line\">tar<span class=\"selector-class\">.gz</span>:</span><br><span class=\"line\">tar -zcvf targzname<span class=\"selector-class\">.tar</span><span class=\"selector-class\">.gz</span> foldername 压缩</span><br><span class=\"line\">tar -zxvf targzname<span class=\"selector-class\">.tar</span><span class=\"selector-class\">.gz</span> pathtosave 解压</span><br><span class=\"line\">tar<span class=\"selector-class\">.bz2</span>:</span><br><span class=\"line\">tar -jcvf tarbz2name<span class=\"selector-class\">.gar</span><span class=\"selector-class\">.bz2</span> foldername 压缩</span><br><span class=\"line\">tar -jxvf tarbz2name<span class=\"selector-class\">.gar</span><span class=\"selector-class\">.bz2</span> -C pathtosave 解压</span><br><span class=\"line\">tar<span class=\"selector-class\">.xz</span>:</span><br><span class=\"line\">xz -d tarxzname<span class=\"selector-class\">.tar</span><span class=\"selector-class\">.xz</span> 解压为tar</span><br><span class=\"line\">tar -xvf tarname<span class=\"selector-class\">.tar</span> 解压为文件夹</span><br><span class=\"line\">tar -xvJf tarxzname<span class=\"selector-class\">.tar</span><span class=\"selector-class\">.xz</span> 直接解压</span><br><span class=\"line\"><span class=\"number\">7</span>z:</span><br><span class=\"line\">sudo apt-get install p7zip-full 安装工具</span><br><span class=\"line\"><span class=\"number\">7</span>z x zip.<span class=\"number\">7</span>z 解压文件</span><br><span class=\"line\">rar:</span><br><span class=\"line\">sudo apt-get install unrar 安装解压工具</span><br><span class=\"line\">unrar x zip<span class=\"selector-class\">.rar</span> 解压文件</span><br></pre></td></tr></table></figure>","categories":[],"tags":[]}